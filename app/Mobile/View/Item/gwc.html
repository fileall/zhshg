<extend name="Base/common"/><block name="header"></block><block name="body">	<body class="body-bgColor">	<!--header-->	<div class="header-wrap">		<div class="header-inner">			<div class="header-title">购物车</div>			<div class="header-left return-prev"><i class="fa fa-angle-left"></i></div>			<div class="header-right">				<div class="compile" id="del">删除</div>			</div>		</div>	</div>	<div class="header-space"></div>	<!--header-->	<!--content-->	<div class="content"><empty name="list[0]">	<!--空购物车-->	<div class="null-wrap vertical-center" >		<div class="vertical-auto">			<div class="null-page">				<div class="null-page-icon"><img src="__MB__images/icon56.png"></div>				<div class="null-page-txt">您的购物车没有商品！</div>				<div class="null-page-link"><a href="{:U('index/cate')}">去逛一逛</a></div>			</div>		</div>	</div>	<!--空购物车--><else />	<div class="shopping-wrap">		<ul class="shopping-ul">			<volist name="list" id="val">				<li class="shopping-li" data-id="{$val['id']}" data-price="{$val['price']}" data-num="{$val['num']}">					<div class="row-box">						<div class="">							<div class="station-check-box shopping-img">								<i class="fa fa-circle-thin"></i>								<input type="checkbox" name="check-single" data-id="{$val.id}">							</div>						</div>						<div class="wicket-images">							<a href="{:U('index/detail',['id'=>$val['item_id']])}" >								<div class="wicket-img-box vertical-center">									<div class="vertical-auto"><img src="{:attach($val['img'],'item')}"></div>								</div>							</a>						</div>						<div class="row-flex">							<div class="purchase-name">{$val['title']}-{$val['attr_name']}</div>							<div class="purchase-money active">￥{$val['price']}<span>￥{$val['oldprice']}</span></div>							<div class="purchase-btn-col">								<div class="row-box wicket-tier" style="padding: 0;">									<div class="wicket-tier-title numbers">数量：</div>									<div class="row-flex">										<div class="wicket-amount row-box">											<div class="wicket-amount-btn minus" data-id="{$val['id']}"><i class="fa fa-minus"></i></div>											<div class="wicket-amount-input row-flex"><input type="number" readonly="readonly" value="{$val['num']}"></div>											<div class="wicket-amount-btn add" data-id="{$val['id']}"><i class="fa fa-plus"></i></div>										</div>									</div>								</div>							</div>						</div>					</div>				</li>			</volist>		</ul>	</div></empty>	</div>	<!--content-->	<!--footer-->	<block name="footer">		<div class="station-space"></div>		<div class="particulars-footer">			<div class="station-wrap row-box">				<div class="">					<div class="station-check">						<label for="check-all">							<div class="station-check-box">								<i class="fa fa-circle-thin"></i>								<input type="checkbox" name="check-all" id="check-all">							</div>							<div class="station-check-txt">全选</div>							<div class="clear-float"></div>						</label>					</div>				</div>				<div class="row-flex">					<div class="station-money">合计：<span>￥100.00</span></div>				</div>				<div class="station-btn one"><a href="javascript:;">结算</a>                    <form action="" method="post" name="js"></form>                </div>				<div class="station-btn two"><a href="javascript:;">删除</a></div>			</div>		</div>	</block>	<!--footer-->	</body></block><block name="script">	<script>    //结算    $('.station-btn').click(function(){        if($('input[type="checkbox"][name="check-single"]:checked').length<1){            layer.msg('请至少选择一件商品！',{icon:0,time:1000});            return false;        }        var ids = new Array();        $('input[type="checkbox"][name="check-single"]:checked').each(function(){            var num=$(this).parents('.shopping-li').find('.wicket-amount-input').find("input").val();            (num != 0)&&ids.push($(this).attr('data-id'));        })        var cart_ids = ids.join(',');//字符串        window.location.href='/mobile.php?s=/item/gwc_settlement/cart_ids/'+cart_ids+'.html';//         $.post('{:U(\'item/gwc_settlement\')}',{cart_ids:cart_ids},function(res){//             if(res.status==1){//                 window.location.href=res.url;//             }else {//                 layer.msg(res.msg, {icon:0, time: 1000});//             }//         })    })	//计算所有选中的商品总价    function count_money(){		var all_money = 0;		$('.shopping-li').each(function(){            var aaa=$(this);            var sib = aaa.find('.add').siblings(".wicket-amount-input");            var num=$(sib).find("input").val();//数量			var price=aaa.attr('data-price');//价格			if (aaa.find('input[type="checkbox"]').prop('checked') == true) {				all_money = all_money + price *num;			}        })		$('.station-money').find('span').html('￥'+all_money.toFixed(2));//保留两位小数	}    count_money();    //购物车    function shoppingFun() {        var li_input = $("input[name='check-single']"); //数据复选框        var li = $(".shopping-li").length; //购物车数据        var num = 0; //计算已选商品        //遍历选中复选框        for(var i = 0; i < li_input.length; i++) {            if(li_input[i].checked) {                num++;            }        }        //删除        function del_shop(ids){            $.post('{:U("item/gwc_del")}',{id:ids},function(d){                if(d.status==1){                    layer.msg(d.msg,{icon:0,time:1000},function(){                        // window.location.href=''+d.url+'';                        $('.shopping-li').each(function(){                            var a = $(this);                            $.each(d.del_ids,function(index,value){                                (a.attr('data-id')==value)&&a.remove();                            });                        })                    })                }else{                    layer.msg(d.msg,{icon:0,time:1000})                }            })        }        $('#del').click(function(){            var arr =new Array();            $('.shopping-li').each(function(){                var a = $(this);                if(a.find('input[type="checkbox"]').prop('checked')==true){                    arr.push(a.attr('data-id'));                }            })            if(!arr[0]){                layer.msg('请选择要删除的商品！',{icon:0,time:2000});                return false;            }            layer.confirm('确认删除吗？', {btn: ['是的','取消']}, function(){                del_shop(arr);            })        })        //单选        $("input[name='check-single']").click(function() {            if(this.checked) {                $(this).parents(".station-check-box").addClass("active");                $(this).parents(".station-check-box").find("i").addClass("fa-check-circle").removeClass("fa-circle-thin");                num++;            } else {                $(this).parents(".station-check-box").removeClass("active");                $(this).parents(".station-check-box").find("i").removeClass("fa-check-circle").addClass("fa-circle-thin");                num--;            }            if(num != li) {                $("input[name='check-all']").prop("checked", false);                $(".station-check").find(".station-check-box").removeClass("active");                $(".station-check").find(".station-check-box i").removeClass("fa-check-circle").addClass("fa-circle-thin");            } else {                $("input[name='check-all']").prop("checked", true);                $(".station-check").find(".station-check-box").addClass("active");                $(".station-check").find(".station-check-box i").addClass("fa-check-circle").removeClass("fa-circle-thin");            }            count_money();        });        //全选        $("input[name='check-all']").click(function() {            if(this.checked) {                $(this).parents(".station-check-box").addClass("active");                $(this).parents(".station-check-box").find("i").addClass("fa-check-circle").removeClass("fa-circle-thin");                $(li_input).prop("checked", true);                $(".shopping-li").find(".station-check-box").addClass("active");                $(".shopping-li").find(".station-check-box i").addClass("fa-check-circle").removeClass("fa-circle-thin");                num = li;            } else {                $(this).parents(".station-check-box").removeClass("active");                $(this).parents(".station-check-box").find("i").removeClass("fa-check-circle").addClass("fa-circle-thin");                $(li_input).prop("checked", false);                $(".shopping-li").find(".station-check-box").removeClass("active");                $(".shopping-li").find(".station-check-box i").removeClass("fa-check-circle").addClass("fa-circle-thin");                num = 0;            }            count_money();        });    }    shoppingFun();    //加    $('.add').click(function(){        var a=$(this);        var sib = $(this).siblings(".wicket-amount-input");        var val = $(sib).find("input").val();        var num = parseInt(val) + 1;        $.post('{:U("Item/gwc_plus")}',{id:a.attr('data-id')},function(d){            if(d.status==1){                $(sib).find("input").val(num);                count_money();            }else if(d.status==-1){                layer.msg(d.msg,{icon:0,time:1000},function(){                    $(sib).find("input").val(d.max_num);//最大库存                    count_money();                })            }else{                layer.msg(d.msg,{icon:0,time:1000},function(){                    count_money();                })            }        })    })    //减    $(".minus").click(function() {        var a=$(this);        var sib = a.siblings(".wicket-amount-input");        var val = $(sib).find("input").val();        var _int = parseInt(val) - 1;        if(val < 1|| val == 1){            layer.msg('请选择至少选择一件',{icon:0,time:1000});			return false;        }		$.post('{:U("Item/gwc_reduce")}',{id:a.attr('data-id')},function(d){			if(d.status==1){				$(sib).find("input").val(_int);				count_money();			}else if(d.status==-1){				layer.msg(d.msg,{icon:0,time:1000},function(){					$(sib).find("input").val(d.max_num);//最大库存                    count_money();                })			}else{				layer.msg(d.msg,{icon:0,time:1000},function(){                        count_money();				})			}		})    });	</script></block></html>