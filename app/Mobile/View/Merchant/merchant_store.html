<extend name="Base/common"/>
<block name="header"></block>
<block name="body">

<body class="body-bgColor">
<!--header-->
<div class="header-wrap">
    <div class="header-inner">
        <div class="header-title">店铺设置</div><a href="{:U('merchant/merchant')}">
        <div class="header-left"><i class="fa fa-angle-left"></i></div></a>
        <div class="header-right"></div>
    </div>
</div>
<div class="header-space"></div>
<!--header-->
<!--选择头像弹出框-->
<!--<div class="y-alert-bg y-mystore-alert-bg">
    <div class="y-mystore-alert y-text-center">
        <div class="y-mystore-alert-item">
            <p class="y-color-red">拍照</p>
            <input   class="y-border-top" type="file" name="submit" value="">从手机相册中选择</input>
        </div>
        &lt;!&ndash;<div class="photograph-form-input">
            <p class="y-color-red">拍照</p>
            <input type="file" id="p">
            从相册中选择
        </div>&ndash;&gt;
        <div class="y-mystore-alert-item y-alert-bankButton2 y-mar-top20">
            <p>取消</p>
        </div>
    </div>
</div>-->
<!--选择头像弹出框-->
<!--content-->
<div class="content">
    <ul class="set-con-ul y-mystore-ul">
        <li class="set-con-li person">
            <div class="set-con-name">商家头像</div>
            <div class="set-con-icon"><i class="fa fa-angle-right"></i></div>
            <div class="person-imges">
                <img src="{:attach($store['img'],'avatar')}">
            </div>
            <!--<input type="" class="aa">-->
            <div class="clear-float"></div>
        </li>
    </ul>
    <div class="font-26 y-color-999 y-width94">店铺基本资料</div>
    <ul class="set-con-ul y-mystore-ul y-mar-top20">
        <li class="set-con-li"><a href="{:U('store_update',array('is_update'=>1))}">
            <div class="set-con-name">商家名称</div>
            <div class="set-con-icon"><i class="fa fa-angle-right"></i></div>
            <div class="set-con-phone y-color-999">{$store['title']}</div>
            <div class="clear-float"></div>
        </a></li>
        <li class="set-con-li"><a href="{:U('store_update',array('is_update'=>2))}">
            <div class="set-con-name">营业时间</div>
            <div class="set-con-icon"><i class="fa fa-angle-right"></i></div>
            <div class="set-con-phone y-color-999">{$store['start']}~{$store['end']}</div>
            <div class="clear-float"></div>
        </a></li>
        <li class="set-con-li">
            <div class="set-con-name">所属行业</div>
            <div class="set-con-id y-color-999">{$store['cate']}</div>
            <div class="clear-float"></div>
        </li>
        <li class="set-con-li">
            <div class="set-con-name">联系电话</div>
            <div class="set-con-id myStore-input">
                <input class="tel y-text-right font-28 y-color-999" readOnly="true"  type="number" id="tel" placeholder="请输入联系电话" pattern="1[3-8][0-9]{9}" value="{$store['tel']}"/>
            </div>
            <div class="clear-float"></div>
        </li>
        <li class="set-con-li">
            <div class="set-con-name">支付方式</div>
            <div class="set-con-id y-color-999">支持{$store['zftype']}支付</div>
            <div class="clear-float"></div>
        </li>
        <li class="set-con-li">
            <div class="set-con-name">消费赠送</div>
            <div class="set-con-id y-color-999">消费赠送{$store['set_coin']}倍银币</div>
            <div class="clear-float"></div>
        </li>

    </ul>
    <div class="font-26 y-color-999 y-width94">地址信息</div>
    <ul class="set-con-ul y-mystore-ul y-mar-top20">
        <li class="set-con-li">
            <div class="set-con-name">省市区</div>
            <div class="set-con-icon"><i class="fa fa-angle-right"></i></div>
            <div class="set-con-phone myStore-input">
                <input class="form-input-celect y-text-right font-28  y-color-999" id="demo1" type="text" readonly="readonly" value="{$store['area']}">
                <input id="value1" type="hidden" value="20,234,504">
            </div>
            <div class="clear-float"></div>
        </li>
        <li class="set-con-li font-26">
            <div class="y-color-999">门店详细地址</div>
            <div class="y-mystore-text y-mar-top20 font-28" id="address" maxlength="30">{$store['address']}</div>
        </li>
    </ul>
    <!--<div>
        <div class="font-26 y-color-999 y-width94">店铺简介</div>
        <textarea class="y-storeclose-text" placeholder="请输入店铺简介"></textarea>
    </div>-->

    <!--<a class="y-mystore-submit y-text-center font-30 y-bg-red" href="javascript:;">确定</a>-->
</div>
<!--content-->

<!--footer-->
<!--footer-->
</body>
</block>
<block name="footer"></block>
<block name="script">
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
    /*var area1 = new LArea();
    area1.init({
        'trigger': '#demo1',
        'valueTo': '#value1',
        'keys': {
            id: 'id',
            name: 'name'
        },
        'type': 1,
        'data': LAreaData
    });*/
        $(".person").click(function(){
            $(".y-alert-bg").addClass("active")
            $(".y-mystore-alert").addClass("active")
        })
        $(".y-alert-bankButton2").click(function(){
            $(".y-alert-bg").removeClass("active")
            $(".y-mystore-alert").removeClass("active")
        })


        wx.config({
            debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
            appId: "{$js['appId']}", // 必填，公众号的唯一标识
            timestamp: "{$js['timestamp']}", // 必填，生成签名的时间戳
            nonceStr: "{$js['nonceStr']}", // 必填，生成签名的随机串
            signature: "{$js['signature']}",// 必填，签名，见附录1
            jsApiList: [ 'chooseImage','previewImage','uploadImage','downloadImage','getLocalImgData'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
        });
        //选择图片
        $(".set-con-li.person").click(function(){
            wx.chooseImage({
                count: 1, // 默认9
                sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
                sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
                success: function (res) {
                    var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
                    uploadImage(localIds);
                }
            });
        })

        //上传图片
        function uploadImage(localIds)
        {
            var localId = localIds.pop()
            wx.uploadImage({
                localId: localId, // 需要上传的图片的本地ID，由chooseImage接口获得
                isShowProgressTips: 1, // 默认为1，显示进度提示
                success: function (res) {
                    var serverId = res.serverId; // 返回图片的服务器端ID
//			    	location.href = "/index.php?m=Mobile&c=Member&a=uploadImage&media_id="+serverId;
                    download(serverId);
                    if (localIds.length > 0) {
                        uploadImage(localIds)
                    }
                }
            });
        }

        //临时文件预览
        function download(serverId) {
//      	location.href = "/index.php?m=Mobile&c=Merchant&a=uploadImage&media_id="+serverId;
            $.post("/index.php?m=Mobile&c=Merchant&a=uploadAvatar", {'media_id': serverId}, function (data) {
                if (data.status == 1) {
                        layer.msg(data.msg,{icon:1,time:1000},function(){
                            $(".person-imges").html('<img  src="data/attachment/avatar/'+data.name+'" />');
                        })
                }else{
                    layer.msg(data.msg,{icon:0,time:1000})
                }
            }, 'json');
        }



</script>
</block>
</html>
